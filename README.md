[![Release](https://github.com/octue/generate-pull-request-description/actions/workflows/release.yml/badge.svg)](https://github.com/octue/generate-pull-request-description/actions/workflows/release.yml)
[![codecov](https://codecov.io/gh/octue/generate-pull-request-description/branch/main/graph/badge.svg?token=J3NFSPZJHW)](https://codecov.io/gh/octue/generate-pull-request-description)
[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&logoColor=white)](https://github.com/pre-commit/pre-commit)
[![black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/ambv/black)

# Pull request description generator
A GitHub action and command-line tool that generates pull request descriptions from Conventional Commit messages on a
branch. These descriptions can be used with other GitHub actions to automate release notes.

**Features**
- Automatic breaking change highlighting and upgrade instructions
- Automatic categorisation of all commit messages in the pull request branch
- Choosing which part of the description to generate, enabling descriptions containing a generated section alongside
  static/developer-written sections
- Easy skipping of description updating when you're ready to fine-tune and edit the description

## GitHub action
The generator can easily be used as a step in a GitHub workflow alongside the
[`riskledger/update-pr-description`](https://github.com/riskledger/update-pr-description) action:

```yaml
steps:
- uses: actions/checkout@v3

- uses: octue/generate-pull-request-description@1.0.0.beta-0
  with:
    pull_request_url: ${{ github.event.pull_request.url }}
    api_token: ${{ secrets.GITHUB_TOKEN }}

- name: Update pull request body
  uses: riskledger/update-pr-description@v2
  with:
    body: ${{ env.PULL_REQUEST_DESCRIPTION }}
    token: ${{ secrets.GITHUB_TOKEN }}
```

The generated description is available from the environment variable `PULL_REQUEST_DESCRIPTION` instead of as an output
of the action (`::set-output...` only works with single-line outputs). It's accessible from
`${{ env.PULL_REQUEST_DESCRIPTION }}` at any point in the workflow job it was used in.

## CLI
```shell
usage: generate-pull-request-description [-h] [--pull-request-url PULL_REQUEST_URL] [--api-token API_TOKEN] [--header HEADER] [--list-item-symbol LIST_ITEM_SYMBOL] [--no-link-to-pull-request] {LAST_RELEASE,PULL_REQUEST_START}

positional arguments:
  {LAST_RELEASE,PULL_REQUEST_START}
                        The point in the git history to stop compiling commits into the pull request description.

options:
  -h, --help            show this help message and exit
  --pull-request-url PULL_REQUEST_URL
                        Provide the API URL of a pull request (e.g. https://api.github.com/repos/octue/conventional-commits/pulls/1) if you want to update a pull request's description with the generated release notes. It must be
                        provided alongside --api-token if the repository is private.
  --api-token API_TOKEN
                        A valid GitHub API token for the repository the pull request belongs to. There is no need to provide this if the repository is public.
  --header HEADER       The header (including MarkDown styling) to put the release notes under. Default is '# Contents'
  --list-item-symbol LIST_ITEM_SYMBOL
                        The MarkDown list item symbol to use for listing commit messages in the release notes. Default is '- '
  --no-link-to-pull-request
                        If provided, don't add a link to the given pull request in the release notes.

```

## Features

### Breaking change highlighting
If breaking changes are indicated in any of the commit messages' bodies via `BREAKING CHANGE:` or `BREAKING-CHANGE:`,
these commits are marked and a warning is added to the top of the release notes. Any other text in these sections is
treated as upgrade instructions and added to the end of the pull request description.

### Choosing which section of the description to update
The only part of the pull request description that is updated by the action is the section bounded by:
- `<!--- START AUTOGENERATED NOTES --->`
- `<!--- END AUTOGENERATED NOTES --->`

This section will always be replaced with a summary of all the commit messages in the pull request so far. The markers
(invisible in rendered markdown) are added in automatically when the action first runs, but you can move them manually.
Any text you add outside of these will remain untouched so you can add, for example, your own static summary of the
pull request while having a dynamic summary of the commits.

### Skipping description updates
Updating the description is skipped if the `<!--- SKIP AUTOGENERATED NOTES --->` marker is present anywhere in the pull
request description. This allows commits to be documented in the description until you're ready to fine-tune or
cherry-pick commit descriptions when your pull request is ready for review.
